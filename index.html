<!-- Avvio di video al riconoscimento di un target immagine.
 
PASSAGGI DA SEGUIRE
 1. IMAGE TARGETS COMPILER: creare il file per il riconoscimento dei target, attraverso questo link(https://hiukim.github.io/mind-ar-js-doc/tools/compile/).
	Il file dev'essere inserito all'interno della sotto-cartella "data", situata nella cartella di progetto.
	1.1 Carica una o più immagini, nell'ordine desiderato.
	1.2 Clicca "Start" e attendi il completamento dell'operazione.
	1.3 Clicca "Download compiler"; verrà scaricato il file "targets.mind", da sostituire a quello presente nella cartella "data".
 2. VIDEO: caricare i video corrispondenti ai diversi target nella sotto-cartella "data". Rinominarli in ordine "video1.mp4", "video2.mp4",... . 
 3. MODIFICARE CODICE (qui segnato in ordine di come è scritto il file).
	3.1 Modificare stile bottone di avvio video
		<style> #startButton: per modificarne gli aspetti visivi e/o posizione.
		<body> <button>: per modificare il testo.
	3.2 Sistemare i TARGET
		Duplicare le linee di codice corrispondenti a quanti target ci sono. 
		<a-entity> mindar-image-target="targetIndex": deve corrispondere al numero del target -1. il primo ha targetIndex = 0, il secondo ha targetIndex = 1,... . 
		<a-video> id="videonElement" //src="#videon" : n corrisponde al numero del target. il terzo target avrà quindi id="video3Element" e src="#video3".
		width="1" height="0.5625": da regolare in base all'aspect ratio del video da riprodurre. 
	3.3 Sistemare i VIDEO OUTPUT
		Duplicare e avere il numero di elementi in base al numero di video necessari.
		Sistemare corrispettivamente gli id e la src corrispondente.
	3.4 Modificare lo script in base al numero di elementi corrispondenti.
		const targetMap: inserire gli id degli elementi video in ordine e separandoli con una virgola.
		[0, 1]: modifica la lista tra parentesi quadre inserendo i target index dei TARGET. se ci sono 3 TARGET da riconoscere, la lista sarà [0, 1, 2] (inizia da 0).

ANTEPRIMA DA VSCODE A MOBILE
Cliccando "Go Live", è possibile avere un'anteprima in locale sul brower. Al suo posto, appare il numero di una porta (ad es. Port: 5500).
Per visualizzarlo su mobile, sono necessari l'indirizzo IP dal tuo pc sul quale si trova il codice che avvii e questo numero di porta.
Da mobile, entrare in una nuova pagina del browser e digitare indirizzoIP:numero porta (ad es. 123.456.7.89:5500).

-->


<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- titolo della pagina web -->
    <title>esempio con più target e partenza video</title>

    <!-- librerie A-Frame, MindAR -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>

    <!-- stile della pagina web -->
    <style>
      body {
        background: #000;
        -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
        margin: 0;
        overflow: hidden;
      }

      #infoButton {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 10;
        padding: 10px 20px;
        font-size: 16px;
        background-color: #fff;
        border: none;
        cursor: pointer;
      }

      #infoPanel {
        position: absolute;
        bottom: -300px;
        left: 0;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 20px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
        transition: bottom 0.5s ease-in-out;
        z-index: 9;
      }

      #infoPanel.open {
        bottom: 0;
      }
    </style>
  </head>

  <body>
    <button id="infoButton">Info</button>
    <div id="infoPanel">
      <h2>Abstract</h2>
      <p>Questo progetto utilizza A-Frame e MindAR per creare un'esperienza di realtà aumentata. Quando una fotografia viene scannerizzata, un video collegato parte automaticamente. Se la fotocamera viene spostata dalla foto, il video si ferma e si resetta. È possibile mettere in muto il video toccandolo. Alla fine del video, questo si resetta e riparte automaticamente.</p>
      <h2>Funzionamento</h2>
      <p>Inquadra una delle fotografie target per avviare il video associato. Toccando il video puoi attivare o disattivare l'audio. Se sposti la fotocamera dalla fotografia, il video si ferma e si resetta, pronto per essere riavviato quando la fotografia viene nuovamente inquadrata.</p>
    </div>

    <!-- MindAR + A-Frame tracking -->
    <a-scene mindar-image="imageTargetSrc: data/targets.mind; filterMinCF:0.0005; filterBeta: .1;" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!--TARGET 1-->
      <a-entity mindar-image-target="targetIndex: 0">
        <a-video id="video1Element" src="#video1" width="1" height="1" position="0 0 0" rotation="0 0 0" autoplay="true" sound="volume: 1"></a-video>
      </a-entity>

      <!--TARGET 2-->
      <a-entity mindar-image-target="targetIndex: 1">
        <a-video id="video2Element" src="#video2" width="1" height="0.5625" position="0 0 0" rotation="0 0 0" autoplay="true" sound="volume: 1"></a-video>
      </a-entity>

    </a-scene>

    <!-- VIDEO OUTPUT -->
    <video id="video1" src="data/video1.mp4" style="display:none;"></video>
    <video id="video2" src="data/video2.mp4" style="display:none;"></video>

    <script>
      document.getElementById('infoButton').addEventListener('click', () => {
        const infoPanel = document.getElementById('infoPanel');
        if (infoPanel.classList.contains('open')) {
          infoPanel.classList.remove('open');
        } else {
          infoPanel.classList.add('open');
        }
      });

      const targetMap = ['video1', 'video2'];

      const setRecognizedTarget = (index, action) => {
        const videoElement = document.getElementById(targetMap[index]);
        if (action === 'found') {
          videoElement.currentTime = 0;  // Reset the video to start
          videoElement.play();
        } else if (action === 'lost') {
          videoElement.pause();
          videoElement.currentTime = 0;
        }
      };

      [0, 1].forEach(index => {
        const targetEntity = document.querySelector(`[mindar-image-target="targetIndex: ${index}"]`);
        targetEntity.addEventListener('targetFound', () => setRecognizedTarget(index, 'found'));
        targetEntity.addEventListener('targetLost', () => setRecognizedTarget(index, 'lost'));
      });

      document.querySelectorAll('a-video').forEach(video => {
        video.addEventListener('click', () => {
          const videoElement = document.getElementById(video.getAttribute('src').substring(1));
          videoElement.muted = !videoElement.muted;
        });
      });
    </script>
  </body>
</html>